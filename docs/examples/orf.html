<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORF Extractor</title>
    <style>
        :root {
            --antiflash-white: #F0F1F1;
            --apple-green: #B6BE00;
            --pine-green: #097E74;
            --charcoal: #2F3D46;
            --light-gray: #E5E7EB;
            --medium-gray: #9CA3AF;
            --dark-gray: #6B7280;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--antiflash-white);
            min-height: 100vh;
            padding: 20px;
            color: var(--charcoal);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 1px solid var(--light-gray);
        }
        
        .header {
            background: var(--pine-green);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .input-section {
            padding: 30px;
            border-bottom: 2px solid var(--light-gray);
            background: var(--antiflash-white);
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-weight: 600;
            color: var(--charcoal);
            font-size: 0.9rem;
        }
        
        select, input {
            padding: 10px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: white;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--pine-green);
            box-shadow: 0 0 0 3px rgba(9, 126, 116, 0.1);
        }
        
        .fasta-input {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
            background: white;
        }
        
        .fasta-input:focus {
            outline: none;
            border-color: var(--pine-green);
            box-shadow: 0 0 0 3px rgba(9, 126, 116, 0.1);
        }
        
        .process-btn {
            background: var(--pine-green);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            margin-top: 15px;
        }
        
        .process-btn:hover {
            background: #075D56;
            transform: translateY(-1px);
        }
        
        .process-btn:disabled {
            background: var(--medium-gray);
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            padding: 30px;
            display: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: 600px;
        }
        
        .results-panel {
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            background: white;
        }
        
        .panel-header {
            background: var(--charcoal);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }
        
        .panel-content {
            padding: 20px;
            height: calc(100% - 55px);
            overflow-y: auto;
        }
        
        .sequence-item {
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .sequence-item:hover {
            border-color: var(--apple-green);
            background: #FCFCF4;
        }
        
        .sequence-item.selected {
            border-color: var(--pine-green);
            background: #F0F9F8;
            box-shadow: 0 2px 8px rgba(9, 126, 116, 0.15);
        }
        
        .sequence-header {
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .sequence-info {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }
        
        .sequence-preview {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: var(--antiflash-white);
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
            max-height: 100px;
            overflow: hidden;
        }
        
        .orf-item {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .orf-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .orf-header {
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 8px;
        }
        
        .orf-info {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 10px;
        }
        
        .orf-sequence {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #F0F9F8;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
            border-left: 4px solid var(--pine-green);
        }
        
        .stats {
            background: var(--antiflash-white);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .stats h3 {
            color: var(--pine-green);
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--dark-gray);
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 2px solid var(--light-gray);
            border-top: 2px solid var(--pine-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--dark-gray);
        }
        
        .empty-state h4 {
            color: var(--charcoal);
            margin-bottom: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>🧬 ORF Extractor</h1>
            <p>Extract Open Reading Frames from nucleotide sequences</p>
        </div>
        
        <!-- Input Section -->
        <div class="input-section">
            <div class="controls">
                <div class="control-group">
                    <label for="geneticCode">Genetic Code:</label>
                    <select id="geneticCode">
                        <option value="1">1. The Standard Code</option>
                        <option value="2">2. The Vertebrate Mitochondrial Code</option>
                        <option value="3">3. The Yeast Mitochondrial Code</option>
                        <option value="4">4. The Mold, Protozoan, and Coelenterate Mitochondrial Code</option>
                        <option value="5">5. The Invertebrate Mitochondrial Code</option>
                        <option value="6">6. The Ciliate, Dasycladacean and Hexamita Nuclear Code</option>
                        <option value="9">9. The Echinoderm and Flatworm Mitochondrial Code</option>
                        <option value="10">10. The Euplotid Nuclear Code</option>
                        <option value="11" selected>11. The Bacterial, Archaeal and Plant Plastid Code</option>
                        <option value="12">12. The Alternative Yeast Nuclear Code</option>
                        <option value="13">13. The Ascidian Mitochondrial Code</option>
                        <option value="14">14. The Alternative Flatworm Mitochondrial Code</option>
                        <option value="15">15. The Blepharisma Nuclear Code</option>
                        <option value="16">16. Chlorophycean Mitochondrial Code</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="minOrfSize">Min ORF Size (aa):</label>
                    <input type="number" id="minOrfSize" value="25" min="1" max="1000">
                </div>
                <div class="control-group">
                    <label for="scanReverse">
                        <input type="checkbox" id="scanReverse"> Scan reverse complement
                    </label>
                </div>
            </div>
            
            <label for="fastaInput">FASTA Sequences:</label>
            <textarea 
                id="fastaInput" 
                class="fasta-input" 
                placeholder="Paste your FASTA sequences here...&#10;&#10;Example:&#10;>sequence1&#10;ATGCGTACGTAGCTAGCTAGC...&#10;>sequence2&#10;ATGAAACCCGGGTTTAGC..."></textarea>
            
            <button id="processBtn" class="process-btn">⚡️ Extract ORFs</button>
        </div>
        
        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <div class="stats" id="statsPanel"></div>
            
            <div class="results-grid">
                <!-- Sequences Panel -->
                <div class="results-panel">
                    <div class="panel-header">📄 Input Sequences (Click to select)</div>
                    <div class="panel-content" id="sequencesPanel"></div>
                </div>
                
                <!-- ORFs Panel -->
                <div class="results-panel">
                    <div class="panel-header">Extracted ORFs</div>
                    <div class="panel-content" id="orfsPanel"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables to store processed data
        let allSequences = [];
        let allORFs = [];
        let selectedSequenceIndex = null;
        
        // Genetic code translation tables
        const GENETIC_CODES = {
            1: "FFLLSSSSYY**CC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            2: "FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSS**VVVVAAAADDEEGGGG",
            3: "FFLLSSSSYY**CCWWTTTTPPPPHHQQRRRRIIMMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            4: "FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            5: "FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSSSSVVVVAAAADDEEGGGG",
            6: "FFLLSSSSYYQQCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            9: "FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNNKSSSSVVVVAAAADDEEGGGG",
            10: "FFLLSSSSYY**CCCWLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            11: "FFLLSSSSYY**CC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            12: "FFLLSSSSYY**CC*WLLLSPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            13: "FFLLSSSSYY**CCWWLLLLPPPPHHQQRRRRIIMMTTTTNNKKSSGGVVVVAAAADDEEGGGG",
            14: "FFLLSSSSYYY*CCWWLLLLPPPPHHQQRRRRIIIMTTTTNNNKSSSSVVVVAAAADDEEGGGG",
            15: "FFLLSSSSYY*QCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG",
            16: "FFLLSSSSYY*LCC*WLLLLPPPPHHQQRRRRIIIMTTTTNNKKSSRRVVVVAAAADDEEGGGG"
        };

        /**
         * Convert a codon (3-letter DNA sequence) to a number (0-63)
         */
        function codonToNumber(codon) {
            const baseValues = {'T': 0, 'C': 1, 'A': 2, 'G': 3, 'U': 0};
            let num = 0;
            
            if (codon.length !== 3) return -1;
            
            for (let i = 0; i < 3; i++) {
                const base = codon[i].toUpperCase();
                if (!(base in baseValues)) return -1;
                num += Math.pow(4, 2 - i) * baseValues[base];
            }
            return num;
        }

        /**
         * Get reverse complement of a DNA sequence
         */
        function reverseComplement(sequence) {
            const complement = {'A': 'T', 'T': 'A', 'G': 'C', 'C': 'G', 'N': 'N'};
            return sequence.toUpperCase()
                .split('')
                .reverse()
                .map(base => complement[base] || 'N')
                .join('');
        }

        /**
         * Translate DNA sequence to protein using genetic code
         */
        function translateSequence(dnaSequence, geneticCode = 11) {
            const codeTable = GENETIC_CODES[geneticCode];
            let protein = '';
            
            // Convert to uppercase and remove non-DNA characters
            const cleanDna = dnaSequence.toUpperCase().replace(/[^ATGCUN]/g, '');
            
            // Translate codons
            for (let i = 0; i <= cleanDna.length - 3; i += 3) {
                const codon = cleanDna.substr(i, 3);
                const codonNum = codonToNumber(codon);
                
                if (codonNum >= 0 && codonNum < codeTable.length) {
                    protein += codeTable[codonNum];
                } else {
                    protein += 'X'; // Unknown amino acid
                }
            }
            
            return protein;
        }

        /**
         * Find ORFs in a protein sequence
         */
        function findORFs(proteinSequence, minSize = 25, sequenceName = '', frame = '', sequenceIndex = 0) {
            const orfs = [];
            let currentOrf = '';
            let startPos = 0;
            
            for (let i = 0; i < proteinSequence.length; i++) {
                const aa = proteinSequence[i];
                
                if (aa === '*' || i === proteinSequence.length - 1) {
                    // End of ORF or end of sequence
                    currentOrf = (aa === '*') ? 
                        proteinSequence.substring(startPos, i) : 
                        proteinSequence.substring(startPos, i + 1);
                    
                    if (currentOrf.length >= minSize) {
                        orfs.push({
                            sequence: currentOrf,
                            length: currentOrf.length,
                            startPos: startPos,
                            endPos: i,
                            frame: frame,
                            sequenceName: sequenceName,
                            sequenceIndex: sequenceIndex
                        });
                    }
                    
                    startPos = i + 1;
                    currentOrf = '';
                }
            }
            
            return orfs;
        }

        /**
         * Parse FASTA format sequences
         */
        function parseFasta(fastaText) {
            const sequences = [];
            const lines = fastaText.trim().split('\n');
            let currentSeq = null;
            
            for (const line of lines) {
                if (line.startsWith('>')) {
                    if (currentSeq) {
                        sequences.push(currentSeq);
                    }
                    currentSeq = {
                        name: line.substring(1).trim(),
                        sequence: ''
                    };
                } else if (currentSeq && line.trim()) {
                    currentSeq.sequence += line.trim();
                }
            }
            
            if (currentSeq) {
                sequences.push(currentSeq);
            }
            
            return sequences;
        }

        /**
         * Process sequences and extract ORFs
         */
        function extractORFs(sequences, options) {
            const allORFs = [];
            
            sequences.forEach((seq, seqIndex) => {
                const seqsToProcess = [
                    {sequence: seq.sequence, name: seq.name, strand: '+'}
                ];
                
                // Add reverse complement if requested
                if (options.scanReverse) {
                    seqsToProcess.push({
                        sequence: reverseComplement(seq.sequence),
                        name: seq.name,
                        strand: '-'
                    });
                }
                
                // Process each sequence (forward and reverse if requested)
                for (const seqData of seqsToProcess) {
                    // Translate in all 3 reading frames
                    for (let frame = 0; frame < 3; frame++) {
                        const frameSeq = seqData.sequence.substring(frame);
                        if (frameSeq.length < options.minOrfSize * 3) continue;
                        
                        const protein = translateSequence(frameSeq, options.geneticCode);
                        const frameLabel = `${seqData.strand}${frame}`;
                        
                        const orfs = findORFs(
                            protein, 
                            options.minOrfSize, 
                            seqData.name, 
                            frameLabel,
                            seqIndex
                        );
                        
                        allORFs.push(...orfs);
                    }
                }
            });
            
            return allORFs;
        }

        /**
         * Handle sequence selection
         */
        function selectSequence(index) {
            selectedSequenceIndex = index;
            
            // Update visual selection
            document.querySelectorAll('.sequence-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            // Filter and display ORFs for selected sequence
            displaySelectedORFs();
            updateStats();
        }

        /**
         * Display sequences in the left panel with click handlers
         */
        function displaySequences(sequences) {
            const panel = document.getElementById('sequencesPanel');
            
            if (sequences.length === 0) {
                panel.innerHTML = '<div class="loading">No sequences found</div>';
                return;
            }
            
            panel.innerHTML = sequences.map((seq, index) => `
                <div class="sequence-item" onclick="selectSequence(${index})" data-index="${index}">
                    <div class="sequence-header">${seq.name}</div>
                    <div class="sequence-info">Length: ${seq.sequence.length} bp</div>
                    <div class="sequence-preview">${seq.sequence.substring(0, 100)}${seq.sequence.length > 100 ? '...' : ''}</div>
                </div>
            `).join('');
            
            // Select first sequence by default
            if (sequences.length > 0) {
                selectSequence(0);
            }
        }

        /**
         * Display ORFs for the selected sequence
         */
        function displaySelectedORFs() {
            const panel = document.getElementById('orfsPanel');
            
            if (selectedSequenceIndex === null) {
                panel.innerHTML = '<div class="empty-state"><h4>Select a sequence</h4><p>Click on a sequence from the left panel to view its ORFs</p></div>';
                return;
            }
            
            // Filter ORFs for selected sequence
            const selectedORFs = allORFs.filter(orf => orf.sequenceIndex === selectedSequenceIndex);
            
            if (selectedORFs.length === 0) {
                const sequenceName = allSequences[selectedSequenceIndex]?.name || 'Selected sequence';
                panel.innerHTML = `<div class="empty-state"><h4>No ORFs found</h4><p>No ORFs found in "${sequenceName}"</p></div>`;
                return;
            }
            
            panel.innerHTML = selectedORFs.map((orf, index) => `
                <div class="orf-item">
                    <div class="orf-header">ORF ${index + 1}: ${orf.sequenceName} (${orf.frame})</div>
                    <div class="orf-info">
                        Length: ${orf.length} aa | Position: ${orf.startPos}-${orf.endPos}
                    </div>
                    <div class="orf-sequence">${orf.sequence}</div>
                </div>
            `).join('');
        }

        /**
         * Display statistics
         */
        function updateStats() {
            const panel = document.getElementById('statsPanel');
            
            let selectedORFs = [];
            let sequenceName = 'All sequences';
            
            if (selectedSequenceIndex !== null) {
                selectedORFs = allORFs.filter(orf => orf.sequenceIndex === selectedSequenceIndex);
                sequenceName = allSequences[selectedSequenceIndex]?.name || 'Selected sequence';
            } else {
                selectedORFs = allORFs;
            }
            
            const avgLength = selectedORFs.length > 0 ? 
                Math.round(selectedORFs.reduce((sum, orf) => sum + orf.length, 0) / selectedORFs.length) : 0;
            
            panel.innerHTML = `
                <h3>📊 Processing Results</h3>
                <p><strong>Total Sequences:</strong> ${allSequences.length}</p>
                <p><strong>Viewing:</strong> ${sequenceName}</p>
                <p><strong>ORFs in Selected:</strong> ${selectedORFs.length}</p>
                <p><strong>Average ORF Length:</strong> ${avgLength} amino acids</p>
            `;
        }

        /**
         * Main processing function
         */
        function processSequences() {
            const fastaInput = document.getElementById('fastaInput').value.trim();
            const geneticCode = parseInt(document.getElementById('geneticCode').value);
            const minOrfSize = parseInt(document.getElementById('minOrfSize').value);
            const scanReverse = document.getElementById('scanReverse').checked;
            const processBtn = document.getElementById('processBtn');
            const resultsSection = document.getElementById('resultsSection');
            
            if (!fastaInput) {
                alert('Please enter FASTA sequences');
                return;
            }
            
            // Show loading state
            processBtn.disabled = true;
            processBtn.textContent = '🔬 Processing...';
            resultsSection.style.display = 'block';
            
            // Reset selection
            selectedSequenceIndex = null;
            
            // Show loading in panels
            document.getElementById('sequencesPanel').innerHTML = '<div class="loading">Processing sequences</div>';
            document.getElementById('orfsPanel').innerHTML = '<div class="loading">Extracting ORFs</div>';
            
            setTimeout(() => {
                try {
                    // Parse FASTA sequences
                    const sequences = parseFasta(fastaInput);
                    
                    if (sequences.length === 0) {
                        alert('No valid FASTA sequences found');
                        return;
                    }
                    
                    // Store globally
                    allSequences = sequences;
                    
                    // Extract ORFs
                    const options = {
                        geneticCode: geneticCode,
                        minOrfSize: minOrfSize,
                        scanReverse: scanReverse
                    };
                    
                    allORFs = extractORFs(sequences, options);
                    
                    // Display results
                    displaySequences(sequences);
                    
                } catch (error) {
                    console.error('Error processing sequences:', error);
                    alert('Error processing sequences: ' + error.message);
                } finally {
                    // Reset button
                    processBtn.disabled = false;
                    processBtn.textContent = '🔬 Extract ORFs';
                }
            }, 100);
        }

        // Event listeners
        document.getElementById('processBtn').addEventListener('click', processSequences);
        
        // Example data for testing
        document.getElementById('fastaInput').addEventListener('focus', function() {
            if (!this.value.trim()) {
                this.value = `>example_sequence_1
ATGAAACGCATTAGCACCACCATTACCACCACCATCACCATTACCACAGGTAACGGTGCGGGCTGACGCGTACAGGAAACACAGAAAAAAGCCCGCACCTGACAGTGCGGGCTTTTTTTTTCGACCAAAGGTAACGAGTGACAGCGAACGCGTGTTGAAACGGGAAATGGCGAAGCCCGGTGGCGGTGAAGCTGAAACTGGTTGTCG

>example_sequence_2
ATGGCGAAAAAGAGCGTCGATTTGGGTGATAAGCGGGACGGCGCGGGCGTTGATGGGCGTGTGGATGCGAGCGTGAAAGACCGCGTGTCTGGGGAAATGACCTTGCGGGAGATTTTTGGCGAAGACCAGGGGAAACTGGTGCGCAGCGTAGACCTGCGGAACGCCATCAAGGATGCCATCGTGACCGGGCTGAACGTCGACGCC`;
            }
        });
    </script>
</body>
</html>